# FigmaTokens

This is a project for extracting FigmaTokens from Figma API and then transform it to CSS, now currently supporting Tailwind.

## Prerequisites

- NodeJS LTS version defined in repository root `./nvmrc`.
- Yarn
- NPM_TOKEN in environment / bash.
- FIGMA_PERSONAL_TOKEN in environment / bash. Then issue a new personal access token: https://grida.co/docs/with-figma/guides/how-to-get-personal-access-token

## How to get started...

### Run on local dev machine directly with Figma

The script is quite simple to run on your local dev machine. Clone this repository and navigate to `./scripts/token-generator/` folder. Make sure you have the prerequisites above in place.

- Run: `yarn install` to install packages.
- Run: `yarn dev` to run script.
- This will generate Tailwind CSS files in the `./generatedFiles/` folder as shown below in a minimal example.

### Run on local dev machine directly with local Mock (working with Figma files)

Typically when adding new parsing rules and CSS for new parts in Figma you want to scan your Figma files for the right patterns.

- Run: `yarn install` to install packages.
- Run: `yarn mock-generate-files` to run script against Figma and download all Figma brand files to `./public/` folder e.g. `figma-file-nameOfFile.json` RAW Figma file and `figma-file-nameOfFile-pretty.json` that is prettified for better readability when searching the file code.
- Run: `yarn mock-dev` to run full script with the local mock files from previous step. This is wise to do to not bother Figma with necessary API calls and to get a better feedback loop as developer.

#### Example
E.g. Extending colors to support gradients is pretty straight forward. Open a brand file generated by the `yarn mock-generate-files` - such as `figma-file-nameOfFile-pretty.json` in **Visual Studio Code** or some other IDE that has no problem reading 300 000 lines in a file.

In this example we can see that the generated Tailwind CSS output for `semanticOverlayPartial` gives: `#NaNNaNNaN4d`. This is based on the name a gradient color that we don't have support for. Next step is to identify the gradient in the Figma File to understand how to parse and transform to valid CSS format.
```json
"semanticOverlayFull": "#3c3c3c",
"semanticOverlayPartial": "#NaNNaNNaN4d"
```
The names in the generated CSS files are coming directly from Figma styles or components names. The script has removed all special characters and made the naming convention lowerCamelCase. In `./src/config.ts` the rules for supported special characters pr. style is defined. For color styles `tokenNameSeparator: ['/']`. That means we can look for colors in Figma named something like `Semantic/overlay/Partial`. I search in the generated file called `figma-file-nameOfFile-styles-pretty.json` since we are looking for color styles. Other Figma Tokens may be in the main file e.g. `figma-file-nameOfFile-pretty.json`.

In this case we find this the following element.
```json
   "1384:24554": {
      "document": {
        "id": "1384:24554",
        "name": "Semantic/overlay/Partial",
        "type": "RECTANGLE",
        "scrollBehavior": "SCROLLS",
        "blendMode": "PASS_THROUGH",
```

The following fill is what we have to work with:
```json
"fills": [
  {
    "blendMode": "NORMAL",
    "type": "GRADIENT_LINEAR",
    "gradientHandlePositions": [
      {
        "x": 0.5006337761123447,
        "y": -9.381261473607425e-15
      },
      {
        "x": 0.5006338068637602,
        "y": 0.9999999999999813
      },
      {
        "x": 0.0006338357169870523,
        "y": 1.5331011203718673e-7
      }
    ],
    "gradientStops": [
      {
        "color": {
          "r": 0,
          "g": 0,
          "b": 0,
          "a": 0
        },
        "position": 0.21875
      },
      {
        "color": {
          "r": 0,
          "g": 0,
          "b": 0,
          "a": 1
        },
        "position": 1
      }
    ]
  }
]
```
Now you have the source - and you build a parsing structure for it inside `figmaTokens.ts` file in the color style section. And then transform it to `transformCSSTailwind.ts`.

## CSS Tailwind Output

The script now supports transforming to Tailwind CSS. Styles, Typography and basic style elements such as border radius, shadows and more are transformed to Tailwind using the standard configuration for extended elements. https://tailwindcss.com/docs/theme#configuration-reference

Minimal example below:
```json
{
    "colors": {
        "baseBlack": "#000000",
        "baseGreyscaleDarkest": "#000000",
        "baseGreyscaleGrey1": "#f2f2f2",
        "baseGreyscaleGrey2": "#a5a5a5"
    },
    "fontFamily": {
      "componentCalloutDesktop": "Futura Passata",
      "componentCalloutMobile": "Futura Passata",
      "componentQuoteDesktop": "Muli",
      "componentQuoteMobile": "Muli"
    },
    "fontWeight": {
      "componentCalloutDesktop": 400,
      "componentCalloutMobile": 400,
      "componentQuoteDesktop": 600,
      "componentQuoteMobile": 600
    },
    "lineHeight": {
        "componentCalloutDesktop": "2.25rem",
        "componentCalloutMobile": "1.875rem",
        "componentQuoteDesktop": "1.875rem",
        "componentQuoteMobile": "1.5rem"
    }
}
```

## How to parse the figma files

### The config file
In `/src/` folder, the `run.ts` dictates the flow of the script. It begins by reading `config.ts` and mapping rules for each brand.

Example below contains `figmaFileId` that you will find in the url when in Figma in a browser viewing the design file. It is the unique identifier string after the `https://www.figma.com/file/<figmaFileId>` part of the url. This file id is all that is needed to read Figma files using the Figma personal access token.

```typescript
{
    name: 'nameOfFile',
    figmaFileId: 'yourFigmaFileID'
}
```

Currently the script supports three different types of tokens in Figma. This can easily be extended to support reading any value from Figma.

```typescript
    {
        borders: {
            tokenNamePrefix: '\\*',
            tokenNameSeparator: ['*', '/', '-'],
            tokenFrameName: 'BorderWeight'
        },
        textStyles: {
            tokenNameSeparator: ['/'],
            figmaType: 'TEXT',
        },
        colorStyles: {
            tokenNameSeparator: ['/'],
            includeFigmaTopFolders: ['Semantic', 'Base'],
            figmaType: 'RECTANGLE'
        }
    }
```
General tokens such as `borders`, `spacing` and more are elements on a canvas with a specific frame name in Figma that can be exported as a value. Set `tokenNamePrefix` with a REGEX to match

# About design tokens
Design tokens are visual design elements that can be abstracted into a shared vocabulary and used to drive design consistency across a product or brand. These tokens can include things like color palettes, typography, spacing scales, and other design elements that are commonly used in a product's user interface.

Design tokens are often used to create a cohesive look and feel across different platforms and devices, such as web, mobile, and desktop applications. They can also be used to ensure that branding and design elements are consistent across different teams and products within a company.

Design tokens are typically stored in a central location, such as a design system or style guide, and can be easily accessed and referenced by designers and developers. This helps to streamline the design process and ensure that all products and designs are consistent with the overall brand aesthetic.

Overall, design tokens are a powerful tool for maintaining design consistency and enabling teams to easily create and iterate on designs while maintaining a cohesive brand identity.

## How to generate design tokens

There are a few different ways to generate design tokens from Figma:

1. Use a plugin: There are several Figma plugins that can help you extract design tokens from your design files. These plugins typically allow you to select specific design elements, such as colors or typography, and generate a file with the corresponding design tokens. Some popular options include Token, Design System Manager, and Style Dictionary.
2. Use the Figma API: The Figma API allows you to programmatically access and manipulate design files. You can use the API to extract design tokens from your Figma files and generate a file with the corresponding design tokens.
3. Manually extract design tokens: You can also manually extract design tokens from your Figma files by selecting the desired design elements and copying them into a separate file or document. This method requires more manual effort, but it can be useful if you only need a few specific design tokens or if you don't have access to the aforementioned tools.

Regardless of which method you choose, it's important to establish a clear naming convention for your design tokens to ensure that they are easily understood and consistent across your organization.

In this project we have chosen approach #2.
